// localStorage.setItem('raw', `
//     # Math
//     Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin dolor diam, venenatis sed tempus nec, ornare ut tellus. Donec et massa in ligula sollicitudin finibus. Quisque vel metus urna. Maecenas ac interdum purus, vel blandit odio. Donec elementum libero mi, sit amet congue enim consectetur nec. Duis quis orci nec arcu condimentum tincidunt. Ut in enim mollis, pulvinar velit sit amet, ullamcorper nisi. Aliquam faucibus, arcu feugiat consectetur tempus, enim mauris mollis nulla, vel rutrum mi lacus vitae magna. Sed nec nulla sed dui venenatis maximus. Integer vitae ligula iaculis, tempor purus nec, interdum lorem. Aliquam suscipit odio sit amet pharetra ultricies. Sed eu purus et nisl suscipit lacinia in nec sem.

//     In tincidunt posuere urna et efficitur. Vestibulum nec est non ligula blandit tincidunt vitae ac eros. Morbi viverra, erat ullamcorper aliquet lacinia, nisi mi commodo erat, in interdum elit purus eget elit. Mauris volutpat dui ac iaculis mollis. In vitae rhoncus ante. Proin ut ex eu dolor porta mattis. Sed blandit, dui eu facilisis elementum, orci odio finibus diam, sed venenatis nisi ipsum vitae lectus. Donec fermentum nibh vitae enim pellentesque pulvinar. Donec ante odio, auctor in felis at, porttitor eleifend diam. In mauris mi, pellentesque eget lacus sed, fermentum tristique odio. Mauris nec venenatis nisl, sed vestibulum nulla. Aenean sed massa ante.

//     ## Differentiation
//     Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin dolor diam, venenatis sed tempus nec, ornare ut tellus. Donec et massa in ligula sollicitudin finibus. Quisque vel metus urna. Maecenas ac interdum purus, vel blandit odio. Donec elementum libero mi, sit amet congue enim consectetur nec. Duis quis orci nec arcu condimentum tincidunt. Ut in enim mollis, pulvinar velit sit amet, ullamcorper nisi. Aliquam faucibus, arcu feugiat consectetur tempus, enim mauris mollis nulla, vel rutrum mi lacus vitae magna. Sed nec nulla sed dui venenatis maximus. Integer vitae ligula iaculis, tempor purus nec, interdum lorem. Aliquam suscipit odio sit amet pharetra ultricies. Sed eu purus et nisl suscipit lacinia in nec sem.

//     In tincidunt posuere urna et efficitur. Vestibulum nec est non ligula blandit tincidunt vitae ac eros. Morbi viverra, erat ullamcorper aliquet lacinia, nisi mi commodo erat, in interdum elit purus eget elit. Mauris volutpat dui ac iaculis mollis. In vitae rhoncus ante. Proin ut ex eu dolor porta mattis. Sed blandit, dui eu facilisis elementum, orci odio finibus diam, sed venenatis nisi ipsum vitae lectus. Donec fermentum nibh vitae enim pellentesque pulvinar. Donec ante odio, auctor in felis at, porttitor eleifend diam. In mauris mi, pellentesque eget lacus sed, fermentum tristique odio. Mauris nec venenatis nisl, sed vestibulum nulla. Aenean sed massa ante.

//     ### First Principals
//     Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin dolor diam, venenatis sed tempus nec, ornare ut tellus. Donec et massa in ligula sollicitudin finibus. Quisque vel metus urna. Maecenas ac interdum purus, vel blandit odio. Donec elementum libero mi, sit amet congue enim consectetur nec. Duis quis orci nec arcu condimentum tincidunt. Ut in enim mollis, pulvinar velit sit amet, ullamcorper nisi. Aliquam faucibus, arcu feugiat consectetur tempus, enim mauris mollis nulla, vel rutrum mi lacus vitae magna. Sed nec nulla sed dui venenatis maximus. Integer vitae ligula iaculis, tempor purus nec, interdum lorem. Aliquam suscipit odio sit amet pharetra ultricies. Sed eu purus et nisl suscipit lacinia in nec sem.

//     ## Integration
//     Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin dolor diam, venenatis sed tempus nec, ornare ut tellus. Donec et massa in ligula sollicitudin finibus. Quisque vel metus urna. Maecenas ac interdum purus, vel blandit odio. Donec elementum libero mi, sit amet congue enim consectetur nec. Duis quis orci nec arcu condimentum tincidunt. Ut in enim mollis, pulvinar velit sit amet, ullamcorper nisi. Aliquam faucibus, arcu feugiat consectetur tempus, enim mauris mollis nulla, vel rutrum mi lacus vitae magna. Sed nec nulla sed dui venenatis maximus. Integer vitae ligula iaculis, tempor purus nec, interdum lorem. Aliquam suscipit odio sit amet pharetra ultricies. Sed eu purus et nisl suscipit lacinia in nec sem.

//     In tincidunt posuere urna et efficitur. Vestibulum nec est non ligula blandit tincidunt vitae ac eros. Morbi viverra, erat ullamcorper aliquet lacinia, nisi mi commodo erat, in interdum elit purus eget elit. Mauris volutpat dui ac iaculis mollis. In vitae rhoncus ante. Proin ut ex eu dolor porta mattis. Sed blandit, dui eu facilisis elementum, orci odio finibus diam, sed venenatis nisi ipsum vitae lectus. Donec fermentum nibh vitae enim pellentesque pulvinar. Donec ante odio, auctor in felis at, porttitor eleifend diam. In mauris mi, pellentesque eget lacus sed, fermentum tristique odio. Mauris nec venenatis nisl, sed vestibulum nulla. Aenean sed massa ante.  

//     ### First Principals
//     Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin dolor diam, venenatis sed tempus nec, ornare ut tellus. Donec et massa in ligula sollicitudin finibus. Quisque vel metus urna. Maecenas ac interdum purus, vel blandit odio. Donec elementum libero mi, sit amet congue enim consectetur nec. Duis quis orci nec arcu condimentum tincidunt. Ut in enim mollis, pulvinar velit sit amet, ullamcorper nisi. Aliquam faucibus, arcu feugiat consectetur tempus, enim mauris mollis nulla, vel rutrum mi lacus vitae magna. Sed nec nulla sed dui venenatis maximus. Integer vitae ligula iaculis, tempor purus nec, interdum lorem. Aliquam suscipit odio sit amet pharetra ultricies. Sed eu purus et nisl suscipit lacinia in nec sem.

//     In tincidunt posuere urna et efficitur. Vestibulum nec est non ligula blandit tincidunt vitae ac eros. Morbi viverra, erat ullamcorper aliquet lacinia, nisi mi commodo erat, in interdum elit purus eget elit. Mauris volutpat dui ac iaculis mollis. In vitae rhoncus ante. Proin ut ex eu dolor porta mattis. Sed blandit, dui eu facilisis elementum, orci odio finibus diam, sed venenatis nisi ipsum vitae lectus. Donec fermentum nibh vitae enim pellentesque pulvinar. Donec ante odio, auctor in felis at, porttitor eleifend diam. In mauris mi, pellentesque eget lacus sed, fermentum tristique odio. Mauris nec venenatis nisl, sed vestibulum nulla. Aenean sed massa ante.

//     # Biology
//     Genetic drift is the random fluctuation in allele frequencies due to chance events. For example if a takahe is killed by a falling tree during a storm, this individual will not be able to contribute their genes to the next generation. Therefore a slight change will occur in the gene pool. In small populations genetic drifts has a larger effect and can lead to alleles becoming lost (0%) or fixed (100%) over a number of generations.
//     The founder effect occurs when a small number of individuals emigrate and become isolated from the 'parent' population. When this happens, an allele that was rare in the 'parent' population may by chance have a higher frequency in the small 'founder' population. Also, many of the genes in the 'parent' gene pool may not be totally absent from the 'daughter' gene pool. As a consequence, the colonising population may evolve in a different direction than the parent population.
// `);
const TreeNode = require('./js/treeNode');
let currentFocus = undefined;
main();

function main() {
    root = TreeNode.decompile();
    const indices = sessionStorage.getItem('indices') ?? "";
    const subRoot = indices != "" ? root.followPath(indices) : root;

    const title = document.getElementById('title');
    title.innerText = subRoot.name;
    title.className += " nt-" + indices;
    if (indices == "") title.contentEditable = "false";

    if (subRoot.content.trim().length > 0) {
        const pTag = document.createElement("p");
        pTag.innerText = subRoot.content;
        pTag.className += " nc-" + indices;
        document.getElementById('inner-content').appendChild(pTag);
    }

    const buildLoop = (subRoot, iteratingNode) => iteratingNode.children.forEach(node => {
        const indices = node.linkIndices();

        const aTag = document.createElement("a");
        aTag.innerText = node.name;
        aTag.ondblclick = () => {
            sessionStorage.setItem('indices', indices);
            root.compile();
            location.reload();
        };
        aTag.className = `content-title t${node.depth - subRoot.depth - 1} nt-${indices}`;


        const pTag = document.createElement("p");
        pTag.innerText = node.content;
        pTag.className += " nc-" + indices;
        
        document.getElementById('inner-content').appendChild(aTag);
        document.getElementById('inner-content').appendChild(pTag);
        
        buildLoop(subRoot, node);
    });

    buildLoop(subRoot, subRoot);

    genBreadCrumb(root, indices);

    // by https://stackoverflow.com/users/1136139/lukaleli
    window.addEventListener("keypress", (e) => {
        if (!(e.which == 115 && e.ctrlKey) && !(event.which == 19)) return true
        download(root.compile(), "notes.md")
        e.preventDefault()
        return false
    });

    document.getElementById('header-set-high').onclick = (ev) => setHeader(1, document.getElementById('header-set-high'));
    document.getElementById('header-set-norm').onclick = (ev) => setHeader(0, document.getElementById('header-set-norm'));
    document.getElementById('header-set-low').onclick = (ev) => setHeader(-1, document.getElementById('header-set-low'));
}

function setHeader(relativeSize, effectingTag) {
    const regexp = /(n[a-z]-([A-z]|\d)+)/g;
    regexp.test(currentFocus);
    console.log(currentFocus.className);
}

function genBreadCrumb(root, indices) {
    const element = document.getElementById('bread-crumb');

    const aTag = document.createElement("a");
    aTag.innerText = root.name;
    aTag.onclick = () => {
        sessionStorage.setItem('indices', root.linkIndices());
        root.compile();
        location.reload();
    };
    element.appendChild(aTag);

    if (indices.length > 0) {
        const pTag = document.createElement("p");
        pTag.innerText = ">";
        element.appendChild(pTag);

        genBreadCrumb(root.children[TreeNode.indexKey.indexOf(indices[0])], indices.slice(1), root);
    }
}

function download(data, filename) {
    const fs = require('fs');
    try { fs.writeFileSync(filename, data, 'utf-8'); }
    catch(e) { alert(e); }
}